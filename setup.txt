sudo if i am not root
apt update && apt udgrade

#rename hostname
hostnamectl set-hostname flsyc-server
nano /etc/hosts ==> add 212.71.250.55 flsync-server

#create user and give him root permissions
adduser novas
adduser novas sudo
usermod -G root novas

#firewall
apt install ufw
ufw default allow outcoming
ufw default deny incoming
ufw allow ssh
#for flask server
ufw allow 5000
#to open ports for sockets
ufw allow 8001:8005
ufw enable
ufw status //to check all is ok

#for mysql
apt-get update
apt-get install mysql-server
#to open a mysql terminal
mysql -u root -p 
mysql> CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';
mysql> GRANT ALL PRIVILEGES ON *.* TO 'username'@'locahost';
mysql> quit 

#for python
apt install python3-pip
apt install python3-venv

#create and run venv
python3 -m venv server/servers_venv
source servers_venv/bin/activate

#for mysql-connector
pip install mysql-connector-python

#to get the libraries that i need and save that in req.txt
pip freeze > req.txt

#to install from req.txt file
pip install -r req.txt 

#to install python-tk 
apt-get install python-tk (restart after)

#run flask
export FLASK_APP=run.py
flask run --host=0.0.0.0

#set all the privates values in /etc/config.json 
nano /etc/config.json
{
    "SECRET_KEY":"mpla mpla mpla"
}
#and i set in my config.py file this
import os, json
with open("/etc/config.json") as config_file:
    config = json.load(config_file)
#and get the secret key like this config.get("SECRET_KEY")

#install nginx
apt install nginx

#isntall unicorn
pip install unicorn

#delete default /etc/sites-enabled/default and create mine  
rm /etc/nginx/sites-enabled/default
nano /etc/nginx/sites-enabled/flsync
server {
	listen 80;
	server_name 212.71.250.55;
	
	location /static {
		alias /home/novas/flask-server/flsync/static;
	}

	location / {
		proxy_pass http://localhost:8000;
		include /etc/nginx/proxy_params;
		proxy_redirect off;
	}
}
ufw allow http/tcp
ufw delete 5000
ufw enable
systemctl restart nginx

#at this time you need to can see your static files hostname/static
#run gunicorm from venv
gunicorn -w 3 run:FLASK_APP

#install supervisor 
sudo nano /etc/supervisor/conf.d/flsync.conf
[program:flsync]
directory=/home/novas/flask-server
command=/home/novas/flask-server/venv/bin/gunicorn -w 3 run:app
user=novas
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stderr_logfile=/var/log/flsync/flsync.err.log
stdout_logfile=/var/log/flsync/flsync.out.log

sudo touch /var/log/flsync/flsync.err.log
sudo touch /var/log/flsync/flsync.out.log
sudo supervisorctl reload

#if i do changes restart
sudo systemctl restart nginx

